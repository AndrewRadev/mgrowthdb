{% from 'pages/studies/visualize/_chart_form.html' import render_chart_form %}

{% extends '_layout.html' %}

{% block title %}: Visualize Study{% endblock %}

{% block head %}
  {% assets "plotly_js" %}
  <script src="{{ ASSET_URL }}" type="text/javascript"></script>
  {% endassets %}
{% endblock %}

{% block content %}
  <div class="container study-page study-visualize-page" data-study-id="{{ study.publicId }}">
    {% include 'pages/studies/_header.html' %}

    <article>
      <h1 class="flex-row flex-gap-10">
        {{ study.name }}

        {% if not study.isPublished: %}
          <span
              class="icon icon-invisible"
              data-tooltip="This study is not published yet. You're seeing this page because you uploaded it, you have permission to manage it, or you're an admin.">
          </span>
        {% endif %}
      </h1>

      {% include 'pages/studies/_navigation_buttons.html' %}

      <p class="help">
        Select an experiment and measurement technique and then check the boxes
        of the measurement subjects you wish to plot. You can add multiple data
        traces on the chart and use the controls at its bottom to shift them
        between the left and right axes to group them by units, e.g. cell
        counts on the left axis, metabolites on the right one.
        {{ "study-pages"|help_link("Read more") }}.
      </p>

      <form class="simple-form chart-form js-chart-form">
        <div class="columns">
          <div class="controls-column">
            {{ render_chart_form(chart_form, study) }}
          </div>

          <div class="chart-column">
            <div class="box">
              <div class="chart">
                <div class="chart-placeholder">
                  ðŸ“Š
                </div>
              </div>
            </div>

            <div class="form-row margin-top-10">
              <label class="full">
                <span>Cell count units:</span>
                <select name="cellCountUnits" class="form-input-blue full">
                  <option>Cells/mL</option>
                  <option>Cells/Î¼L</option>
                </select>
              </label>

              <label class="full">
                <span>CFU count units</span>
                <select name="cfuCountUnits" class="form-input-blue full">
                  <option>CFUs/mL</option>
                  <option>CFUs/Î¼L</option>
                </select>
              </label>

              <label class="full">
                <span>Metabolite units:</span>
                <select name="metaboliteUnits" class="form-input-blue full">
                  <optgroup label="Molar concentration">
                    <option value="mM">Millimolars (mM)</option>
                    <option value="Î¼M">Micromolars (Î¼M)</option>
                    <option value="nM">Nanomolars (nM)</option>
                    <option value="pM">Picomolars (pM)</option>
                  </optgroup>
                  <optgroup label="Mass concentration">
                    <option value="g/L">Grams per Liter (g/L)</option>
                    <option value="mg/L">Milligrams per Liter (mg/L)</option>
                  </optgroup>
                </select>
              </label>
            </div>

            <div class="form-row flex-column flex-gap-6 margin-top-10">
              <label>
                <input type="checkbox" name="showStd" {{ "checked" if chart_form.show_std }}>
                Show standard deviation
              </label>
              <label>
                <input type="checkbox" name="showPerturbations" {{ "checked" if chart_form.show_perturbations }}>
                Show perturbations
              </label>
            </div>
          </div>
        </div>
      </form>
    </article>
  </div>
{% endblock %}
