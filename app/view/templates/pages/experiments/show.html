{% from 'pages/experiments/_bioreplicates_list.html' import render_bioreplicates_list %}
{% from 'pages/experiments/_bioreplicates_toc.html' import render_bioreplicates_toc %}
{% from 'pages/perturbations/_perturbation.html' import render_perturbation %}
{% from 'utils/_strain_link.html' import render_strain_link %}

{% extends '_layout.html' %}

{% block title %}: Experiment {{ experiment.publicId }}{% endblock %}

{% block content %}
  {% set study = experiment.study %}

  <div class="container experiment-page">
    {% include 'pages/experiments/_header.html' %}

    <article>
      <h1>Experiment: {{ experiment.name }}</h1>

      <p class="small">
        {% if study.url: %}
          <strong>Publication</strong>: {{ study.url|external_link }}

          {% if study.authors: %}
            by {{ study.authors|author_link_list(limit=10) }}
          {% endif %}

          <br>
        {% endif %}
      </p>

      {% if experiment.description: %}
        {{ experiment.description|format_text }}
      {% endif %}

      <br>

      <div>
        <h3>Compartments</h3>

        <ol>
          {% for compartment in experiment.compartments: %}
            <li>
              <strong>{{ compartment.name }}</strong>

              <br>

              Medium:
              {% if compartment.mediumUrl: %}
                {{ compartment.mediumUrl|external_link(compartment.mediumName) }}
              {% else: %}
                {{ compartment.mediumName }}
              {% endif %}

              <br>

              Properties: {{ compartment.properties_description|safe }}
            </li>
          {% endfor %}
        </ol>

        <h3>Community: {{ experiment.community.name }}</h3>

        <ol>
          {% for strain in experiment.community.strains: %}
            <li>{{ render_strain_link(strain) }}</li>
          {% endfor %}
        </ol>

        {% if experiment.perturbations|length > 0: %}
          <h3>Perturbations</h3>

          <ol>
            {% for perturbation in experiment.perturbations: %}
              {{ render_perturbation(perturbation, link=True) }}
            {% endfor %}
          </ol>
        {% endif %}

        <div class="flex-row">
          <div class="bioreplicates full">
            <h2>Biological replicates</h2>

            {{ render_bioreplicates_list(experiment) }}
          </div>

          <div class="toc-container">
            {{ render_bioreplicates_toc(experiment) }}
          </div>
        </div>
      </div>
    </article>
  </div>
{% endblock %}
